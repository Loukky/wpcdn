layui.use(["form","element","layer","laydate"],function(){var form=layui.form;var element=layui.element;var layer=layui.layer;var laydate=layui.laydate;laydate.render({elem:"#date",range:"|"});laydate.render({elem:"#start-time",done:function(value,date,endDate){start_time=value}});laydate.render({elem:"#end-time",done:function(value,date,endDate){end_time=value}});var element=layui.element;var layid=location.hash.replace(/^#site=/,"");element.tabChange("site",layid);element.on("tab(site)",function(){location.hash="site="+this.getAttribute("lay-id")});layer.photos({photos:"#showimgs",anim:5});form.on("submit(formsite)",function(data){$.post("/set/site",data.field,function(data){try{var info=JSON.parse(data);layer.msg(info.msg,{icon:1})}catch(e){layer.msg("添加失败:"+e,{icon:5})}});return false});form.on("submit(search_user)",function(data){var uid=md5(data.field.email.toLowerCase());window.open("/admin/edit_user/"+uid,"_blank");return false});form.on("submit(form_user_register)",function(data){console.log(data.field);$.post("/set/set_user_register",data.field,function(data,status){if(data.code==200){layer.msg(data.msg,{icon:1})}else{layer.msg(data.msg,{icon:5})}});return false});form.on("submit(set_smtp)",function(data){console.log(data.field);$.post("/set/set_smtp",data.field,function(data,status){if(data.code==200){layer.msg(data.msg,{icon:1})}else{layer.msg(data.msg,{icon:5})}});return false});form.on("submit(test_smtp)",function(data){console.log(data.field);$.post("/set/send_test_mail",data.field,function(data,status){if(data.code==200){layer.msg(data.msg,{icon:1})}else{layer.msg("发送失败，请查看下方SMTP日志！",{icon:5});$("#smtp_log").text(data.msg)}});return false});form.on("submit(set_porn_recognition)",function(data){console.log(data.field);$.post("/set/set_porn_recognition",data.field,function(data,status){if(data.code==200){layer.msg(data.msg,{icon:1})}else{layer.msg(data.msg,{icon:5})}});return false});form.on("submit(set_site_menu)",function(data){console.log(data.field);$.post("/set/set_site_menu",data.field,function(data,status){if(data.code==200){layer.msg(data.msg,{icon:1})}else{layer.msg(data.msg,{icon:5})}});return false});form.on("submit(set_site_notice)",function(data){console.log(data.field);$.post("/set/set_site_notice",data.field,function(data,status){if(data.code==200){layer.msg(data.msg,{icon:1})}else{layer.msg(data.msg,{icon:5})}});return false});form.on("submit(set_site_others)",function(data){console.log(data.field);$.post("/set/set_site_others",data.field,function(data,status){if(data.code==200){layer.msg(data.msg,{icon:1})}else{layer.msg(data.msg,{icon:5})}});return false});form.on("submit(vip_default_storage)",function(data){$.post("/set/set_vip_default_storage",data.field,function(data,status){if(data.code==200){layer.msg(data.msg,{icon:1})}else{layer.msg(data.msg,{icon:5})}});return false});form.on("submit(form_notice)",function(data){$.post("/set/options/notice",data.field,function(data){try{var info=JSON.parse(data);layer.msg(info.msg,{icon:1})}catch(e){layer.msg("添加失败:"+e,{icon:5})}});return false});form.on("submit(form_footer)",function(data){$.post("/set/options/footer",data.field,function(data){try{var info=JSON.parse(data);layer.msg(info.msg,{icon:1})}catch(e){layer.msg("添加失败:"+e,{icon:5})}});return false});form.on("submit(form_page_notice)",function(data){$.post("/set/options/page_notice",data.field,function(data){try{var info=JSON.parse(data);layer.msg(info.msg,{icon:1})}catch(e){layer.msg("添加失败:"+e,{icon:5})}});return false});form.on("submit(form_tinypng)",function(data){$.post("/set/tinypng",data.field,function(data){try{var info=JSON.parse(data);layer.msg(info.msg,{icon:1})}catch(e){layer.msg("添加失败:"+e,{icon:5})}});return false});form.on("submit(form_moderate)",function(data){$.post("/set/moderate",data.field,function(data){try{var info=JSON.parse(data);layer.msg(info.msg,{icon:1})}catch(e){layer.msg("添加失败:"+e,{icon:5})}});return false});form.on("switch(upswitch)",function(data){console.log(data.elem.checked);if(data.elem.checked==false){$("#limit").val(0)}else if(data.elem.checked==true){$("#limit").val(10)}});form.on("submit(formuplimit)",function(data){console.log(data.field);$.post("/set/uplimit",data.field,function(data){try{var info=JSON.parse(data);layer.msg(info.msg,{icon:1})}catch(e){layer.msg("设置失败:"+e,{icon:5})}});return false});form.on("submit(set_init_num)",function(data){console.log(data.field);$.post("/set/set_up_limit",data.field,function(data){try{if(data.code==200){layer.msg(data.msg,{icon:1})}else{layer.msg(data.msg,{icon:5})}}catch(e){layer.msg("设置失败:"+e,{icon:5})}});return false});form.on("submit(formtiny)",function(data){});form.on("submit(formModerate)",function(data){});form.on("submit(formlocalhost)",function(data){$.post("/set/storage/localhost",data.field,function(data){try{var info=JSON.parse(data);layer.msg(info.msg,{icon:1})}catch(e){layer.msg("设置失败:"+e,{icon:5})}});return false});form.on("submit(formb2)",function(data){$.post("/set/storage/backblaze",data.field,function(data){try{var info=JSON.parse(data);layer.msg(info.msg,{icon:1})}catch(e){layer.msg("设置失败:"+e,{icon:5})}});return false});form.on("submit(form_cos)",function(data){$.post("/set/storage/cos",data.field,function(data){try{var info=JSON.parse(data);layer.msg(info.msg,{icon:1})}catch(e){layer.msg("设置失败:"+e,{icon:5})}});return false});form.on("submit(form_qiniu)",function(data){$.post("/set/storage/qiniu",data.field,function(data){try{var info=JSON.parse(data);layer.msg(info.msg,{icon:1})}catch(e){layer.msg("设置失败:"+e,{icon:5})}});return false});form.on("submit(form_s3)",function(data){$.post("/set/storage/aws_s3",data.field,function(data){try{var info=JSON.parse(data);layer.msg(info.msg,{icon:1})}catch(e){layer.msg("设置失败:"+e,{icon:5})}});return false});form.on("submit(saveToken)",function(data){$.post("/set/save_token_status",data.field,function(data,status){try{var info=JSON.parse(data);layer.msg(info.msg,{icon:1})}catch(e){layer.msg("设置失败:"+e,{icon:5})}});return false});form.on("submit(saveIP)",function(data){$.post("/set/saveIP",data.field,function(data,status){try{var info=JSON.parse(data);if(info.code==200){layer.msg(info.msg,{icon:1})}else{layer.msg(info.msg,{icon:5})}}catch(e){layer.msg("设置失败:"+e,{icon:5})}});return false});form.on("submit(chgToken)",function(data){$.post("/set/change_token",data.field,function(data,status){try{var info=JSON.parse(data);var token=info.data.values;$("#token").val(token);layer.msg(info.msg,{icon:1})}catch(e){layer.msg("设置失败:"+e,{icon:5})}});return false});form.on("submit(form_ftp)",function(data){$.post("/set/storage/ftp",data.field,function(data){try{var info=JSON.parse(data);if(info.code==200){layer.msg(info.msg,{icon:1})}else if(info.code==0){layer.msg(info.msg,{icon:5})}}catch(e){layer.msg("设置失败:"+e,{icon:5})}});return false});form.on("submit(batch_delete)",function(data){var date=$("#date").val();date=date.replace(" | ","|");var engine=data.field.engine;layer.confirm("真的要删除（不可逆）？",{icon:3,title:"危险提示："},function(index){layer.load(2);$.get("/del/batch_del/"+date+"/"+engine+"/"+data.field.user,function(data,status){if(status=="success"){try{data=JSON.parse(data);if(data.code==200){layer.closeAll("loading");layer.open({title:"操作完成",content:"已删除"+data.num+"张图片！"})}}catch(e){layer.closeAll("loading");console.log(e)}}});layer.close(index)});return false})});function urlup(){var arrurl=$("#arrurl").val();var remsg="";if(arrurl==""){layer.msg("请填写URL地址！");return false}arrurl=arrurl.split("\n");layer.load();for(var j=0,len=arrurl.length;j<len;j++){$.ajax({type:"post",url:"/upload/url",data:"url="+arrurl[j],async:true,success:function(data){var re=JSON.parse(data);remsg+=re.msg+"\n";$("#urlupmsg").val(remsg)}})}layer.closeAll("loading")}function up_load(){layer.load()}
function showlink(url,thumburl){
    layer.open({
        type:1,title:false,
        content:$("#imglink"),
//area:["600px","260px"]});
		maxWidth:'600',
	  offset:'auto'
$("#img-thumb a").attr("href",thumburl);
$("#img-thumb img").attr("src",thumburl);
$("#url").val(url);
$("#html").val("<img src = '"+url+"' />");
$("#markdown").val("![]("+url+")");
$("#bbcode").val("[img]"+url+"[/img]");
$("#imglink").show()}
function copyurl(info){var copy=new clipBoard(document.getElementById("links"),{beforeCopy:function(){info=$("#"+info).val()},copy:function(){return info},afterCopy:function(){}});layui.use("layer",function(){var layer=layui.layer;layer.msg("链接已复制！",{time:2e3})})}
    function imginfo(imgid,title){
        layer.open({
            type:2,
            title:title,
           //area:["580px","420px"],
				maxWidth:'600',
		maxHeight:'360',
	  offset:'auto',
            content:"/manage/imginfo/"+imgid})}
            function del_img(id,imgid,path,thumbnail_path){layer.confirm("确认删除这张图片？",{icon:3,title:"温馨提示！"},function(index){$.post("/set/del_img",{imgid:imgid,path:path,thumbnail_path:thumbnail_path},function(data,status){var re=JSON.parse(data);if(re.code==200){$("#img"+id).remove();console.log("#img"+id)}else{layer.msg(data)}});layer.close(index)})}function del_id(id){layer.confirm("确认删除这张图片？",{icon:3,title:"温馨提示！"},function(index){$.get("/del/id/"+id,function(data,status){var re=JSON.parse(data);if(re.code==200){$("#img"+id).remove()}else{layer.msg(data)}});layer.close(index)})}function mycore(){uri=location.pathname;if(uri=="/admin/"||uri=="/admin/index"){$.get("/admin/core",function(data,status){if(data.code=="-1000"){alert(data.msg)}else{return true}})}}function compress(id,storage){if(storage!="localhost"){layer.msg(storage+"类型不支持压缩！");return false}var index=layer.load();$.get("/deal/compress/"+id,function(data,status){re=JSON.parse(data);if(re.code==200){layer.close(index);layer.msg(re.msg)}else if(re.code==0){layer.close(index);layer.msg(re.msg)}else{layer.close(index);layer.msg(data)}})}function cancel(id){layer.confirm("确定取消可疑状态？",{icon:3,title:"温馨提示！"},function(index){$.get("/set/cancel/"+id,function(data,status){var re=JSON.parse(data);if(re.code==200){layer.msg("操作成功，请手动刷新页面！")}else{layer.msg(data)}});layer.close(index)})}function del_more(){var chkIds="";$("input:checkbox:checked").each(function(i){chkIds+=$(this).val()+","});ids=chkIds.split(",");layer.confirm("确认删除多张图片？（不可恢复）",{icon:3,title:"温馨提示！"},function(index){for(var i=0;i<ids.length-1;i++){$.get("/del/id/"+ids[i],function(data,status){var re=JSON.parse(data);if(re.code==200){$("#img"+re.id).remove();console.log("#img"+re.id)}else{layer.msg(data)}})}layer.close(index)})}function cancel_dubious(){var chkIds="";$("input:checkbox:checked").each(function(i){chkIds+=$(this).val()+","});ids=chkIds.split(",");layer.confirm("确定取消可疑状态？",{icon:3,title:"温馨提示！"},function(index){for(var i=0;i<ids.length-1;i++){$.get("/set/cancel/"+ids[i],function(data,status){var re=JSON.parse(data);if(re.code==200){$("#img"+re.id).remove();console.log("#img"+ids[i])}else{layer.msg(data)}})}layer.close(index)})}function version(){layer.open({title:"当前版本：",area:["240px","100px"],type:2,content:"/maintain/version"})}mycore();$("#checkAll").click(function(){if(this.checked){$("input[name='chk']:checkbox").each(function(){$(this).attr("checked",true)})}else{$("input[name='chk']:checkbox").each(function(){$(this).attr("checked",false)})}});function findimg(){var value=$("#value").val();var type=$("#type").val();if(type==""){layer.msg("请选择筛选条件！");return false}else if(value==""){layer.msg("请输入值！");return false}else if(type=="email"){uid=md5(value);window.location.href="/manage/images/"+uid+"/0";return false}window.location.href="/manage/images/"+type+"/?value="+value}function find_date_img(){var user=$("#user").val();var date=start_time+"|"+end_time;if(user==""){layer.msg("请选择筛选条件！");return FALSE}else if(start_time==""){layer.msg("请选择开始日期！");return FALSE}else if(end_time==""){layer.msg("请选择结束日期！");return FALSE}window.location.href="/manage/images/"+user+"/?date="+date}function check_all(){$("input[name='chk']").attr("checked","true")}function cancel_all(){$("input[name='chk']").removeAttr("checked")}function search_user(){var uid=md5($("#email").val());window.open("/admin/edit_user/"+uid,"_blank")}
